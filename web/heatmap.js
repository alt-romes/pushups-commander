
const datas2 = { // {{{
    "took": 10,
    "timed_out": false,
    "_shards": {
        "total": 5,
        "successful": 5,
        "skipped": 0,
        "failed": 0
    },
    "hits": {
        "total": 142,
        "max_score": null,
        "hits": []
    },
    "aggregations": {
        "2": {
            "doc_count_error_upper_bound": 0,
            "sum_other_doc_count": 0,
            "buckets": [
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 120
                                },
                                "key": 6,
                                "doc_count": 2
                            },
                            {
                                "1": {
                                    "value": 30
                                },
                                "key": 5,
                                "doc_count": 2
                            },
                            {
                                "1": {
                                    "value": 100
                                },
                                "key": 2,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 100
                                },
                                "key": 1,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 1,
                    "doc_count": 6
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 50
                                },
                                "key": 7,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 110
                                },
                                "key": 4,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 100
                                },
                                "key": 3,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 2,
                    "doc_count": 3
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 33
                                },
                                "key": 6,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 200
                                },
                                "key": 3,
                                "doc_count": 2
                            },
                            {
                                "1": {
                                    "value": 100
                                },
                                "key": 2,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 5,
                    "doc_count": 4
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 1,
                        "buckets": [
                            {
                                "1": {
                                    "value": 44
                                },
                                "key": 7,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 8
                                },
                                "key": 6,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 42
                                },
                                "key": 5,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 40
                                },
                                "key": 4,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 36
                                },
                                "key": 3,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 6,
                    "doc_count": 6
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 40
                                },
                                "key": 5,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 46
                                },
                                "key": 4,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 75
                                },
                                "key": 1,
                                "doc_count": 2
                            }
                        ]
                    },
                    "key": 7,
                    "doc_count": 4
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 30
                                },
                                "key": 5,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 42
                                },
                                "key": 4,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 40
                                },
                                "key": 3,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 90
                                },
                                "key": 1,
                                "doc_count": 2
                            }
                        ]
                    },
                    "key": 8,
                    "doc_count": 5
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 6
                                },
                                "key": 6,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 40
                                },
                                "key": 5,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 80
                                },
                                "key": 1,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 9,
                    "doc_count": 3
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 40
                                },
                                "key": 4,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 6.01
                                },
                                "key": 3,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 10,
                    "doc_count": 2
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 39.84
                                },
                                "key": 4,
                                "doc_count": 2
                            },
                            {
                                "1": {
                                    "value": 7
                                },
                                "key": 3,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 11,
                    "doc_count": 3
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 35
                                },
                                "key": 3,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 42.46
                                },
                                "key": 2,
                                "doc_count": 2
                            }
                        ]
                    },
                    "key": 12,
                    "doc_count": 3
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 186.01
                                },
                                "key": 1,
                                "doc_count": 5
                            }
                        ]
                    },
                    "key": 13,
                    "doc_count": 5
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 36
                                },
                                "key": 5,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 70
                                },
                                "key": 4,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 65
                                },
                                "key": 1,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 14,
                    "doc_count": 3
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 150
                                },
                                "key": 1,
                                "doc_count": 3
                            }
                        ]
                    },
                    "key": 15,
                    "doc_count": 3
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 30
                                },
                                "key": 2,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 182
                                },
                                "key": 1,
                                "doc_count": 3
                            }
                        ]
                    },
                    "key": 16,
                    "doc_count": 4
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 7.26
                                },
                                "key": 2,
                                "doc_count": 2
                            }
                        ]
                    },
                    "key": 17,
                    "doc_count": 2
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 0.9
                                },
                                "key": 3,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 60
                                },
                                "key": 2,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 18,
                    "doc_count": 2
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 30
                                },
                                "key": 7,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 30
                                },
                                "key": 4,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 30
                                },
                                "key": 2,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 19,
                    "doc_count": 3
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 3,
                        "buckets": [
                            {
                                "1": {
                                    "value": 30
                                },
                                "key": 7,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 30
                                },
                                "key": 6,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 124.51
                                },
                                "key": 5,
                                "doc_count": 5
                            },
                            {
                                "1": {
                                    "value": 30
                                },
                                "key": 4,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 150
                                },
                                "key": 2,
                                "doc_count": 2
                            }
                        ]
                    },
                    "key": 20,
                    "doc_count": 13
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 30
                                },
                                "key": 7,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 60
                                },
                                "key": 6,
                                "doc_count": 2
                            },
                            {
                                "1": {
                                    "value": 30
                                },
                                "key": 5,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 60
                                },
                                "key": 1,
                                "doc_count": 2
                            }
                        ]
                    },
                    "key": 21,
                    "doc_count": 6
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 35
                                },
                                "key": 7,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 32
                                },
                                "key": 6,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 30
                                },
                                "key": 5,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 32
                                },
                                "key": 3,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 30
                                },
                                "key": 1,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 22,
                    "doc_count": 5
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 35
                                },
                                "key": 6,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 130
                                },
                                "key": 5,
                                "doc_count": 3
                            },
                            {
                                "1": {
                                    "value": 35
                                },
                                "key": 2,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 23,
                    "doc_count": 5
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 25
                                },
                                "key": 7,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 5.5
                                },
                                "key": 6,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 20
                                },
                                "key": 3,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 180
                                },
                                "key": 1,
                                "doc_count": 4
                            }
                        ]
                    },
                    "key": 24,
                    "doc_count": 7
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 150
                                },
                                "key": 6,
                                "doc_count": 3
                            },
                            {
                                "1": {
                                    "value": 30
                                },
                                "key": 5,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 30
                                },
                                "key": 3,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 25,
                    "doc_count": 5
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 260
                                },
                                "key": 7,
                                "doc_count": 3
                            },
                            {
                                "1": {
                                    "value": 60
                                },
                                "key": 5,
                                "doc_count": 2
                            },
                            {
                                "1": {
                                    "value": 50
                                },
                                "key": 3,
                                "doc_count": 2
                            }
                        ]
                    },
                    "key": 26,
                    "doc_count": 7
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 31
                                },
                                "key": 6,
                                "doc_count": 2
                            },
                            {
                                "1": {
                                    "value": 240
                                },
                                "key": 3,
                                "doc_count": 3
                            },
                            {
                                "1": {
                                    "value": 50
                                },
                                "key": 2,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 80
                                },
                                "key": 1,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 27,
                    "doc_count": 7
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 1
                                },
                                "key": 4,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 300
                                },
                                "key": 3,
                                "doc_count": 5
                            }
                        ]
                    },
                    "key": 28,
                    "doc_count": 6
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 35
                                },
                                "key": 4,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 32
                                },
                                "key": 1,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 29,
                    "doc_count": 2
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 90
                                },
                                "key": 5,
                                "doc_count": 2
                            }
                        ]
                    },
                    "key": 31,
                    "doc_count": 2
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 35
                                },
                                "key": 7,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 30
                                },
                                "key": 5,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 37,
                    "doc_count": 2
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 240
                                },
                                "key": 3,
                                "doc_count": 3
                            }
                        ]
                    },
                    "key": 38,
                    "doc_count": 3
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 60
                                },
                                "key": 6,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 40,
                    "doc_count": 1
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 55
                                },
                                "key": 2,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 41,
                    "doc_count": 1
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 60
                                },
                                "key": 4,
                                "doc_count": 2
                            }
                        ]
                    },
                    "key": 44,
                    "doc_count": 2
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 20
                                },
                                "key": 3,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 46,
                    "doc_count": 1
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 25
                                },
                                "key": 7,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 10
                                },
                                "key": 1,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 47,
                    "doc_count": 2
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 25
                                },
                                "key": 4,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 48,
                    "doc_count": 1
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 40
                                },
                                "key": 1,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 51,
                    "doc_count": 1
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 100
                                },
                                "key": 7,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 100
                                },
                                "key": 6,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 52,
                    "doc_count": 2
                }
            ]
        }
    }
} // }}}

const data = { // {{{
    "took": 18,
    "timed_out": false,
    "_shards": {
        "total": 5,
        "successful": 5,
        "skipped": 0,
        "failed": 0
    },
    "hits": {
        "total": 139,
        "max_score": null,
        "hits": []
    },
    "aggregations": {
        "2": {
            "doc_count_error_upper_bound": 0,
            "sum_other_doc_count": 0,
            "buckets": [
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 120
                                },
                                "key": 6,
                                "doc_count": 2
                            },
                            {
                                "1": {
                                    "value": 30
                                },
                                "key": 5,
                                "doc_count": 2
                            },
                            {
                                "1": {
                                    "value": 100
                                },
                                "key": 2,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 100
                                },
                                "key": 1,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 1,
                    "doc_count": 6
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 50
                                },
                                "key": 7,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 110
                                },
                                "key": 4,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 100
                                },
                                "key": 3,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 2,
                    "doc_count": 3
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 33
                                },
                                "key": 6,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 5,
                    "doc_count": 1
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 1,
                        "buckets": [
                            {
                                "1": {
                                    "value": 44
                                },
                                "key": 7,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 8
                                },
                                "key": 6,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 42
                                },
                                "key": 5,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 40
                                },
                                "key": 4,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 36
                                },
                                "key": 3,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 6,
                    "doc_count": 6
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 40
                                },
                                "key": 5,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 46
                                },
                                "key": 4,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 75
                                },
                                "key": 1,
                                "doc_count": 2
                            }
                        ]
                    },
                    "key": 7,
                    "doc_count": 4
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 30
                                },
                                "key": 5,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 42
                                },
                                "key": 4,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 40
                                },
                                "key": 3,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 90
                                },
                                "key": 1,
                                "doc_count": 2
                            }
                        ]
                    },
                    "key": 8,
                    "doc_count": 5
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 6
                                },
                                "key": 6,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 40
                                },
                                "key": 5,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 80
                                },
                                "key": 1,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 9,
                    "doc_count": 3
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 40
                                },
                                "key": 4,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 6.01
                                },
                                "key": 3,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 10,
                    "doc_count": 2
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 39.84
                                },
                                "key": 4,
                                "doc_count": 2
                            },
                            {
                                "1": {
                                    "value": 7
                                },
                                "key": 3,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 11,
                    "doc_count": 3
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 35
                                },
                                "key": 3,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 42.46
                                },
                                "key": 2,
                                "doc_count": 2
                            }
                        ]
                    },
                    "key": 12,
                    "doc_count": 3
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 186.01
                                },
                                "key": 1,
                                "doc_count": 5
                            }
                        ]
                    },
                    "key": 13,
                    "doc_count": 5
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 36
                                },
                                "key": 5,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 70
                                },
                                "key": 4,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 65
                                },
                                "key": 1,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 14,
                    "doc_count": 3
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 150
                                },
                                "key": 1,
                                "doc_count": 3
                            }
                        ]
                    },
                    "key": 15,
                    "doc_count": 3
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 30
                                },
                                "key": 2,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 182
                                },
                                "key": 1,
                                "doc_count": 3
                            }
                        ]
                    },
                    "key": 16,
                    "doc_count": 4
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 7.26
                                },
                                "key": 2,
                                "doc_count": 2
                            }
                        ]
                    },
                    "key": 17,
                    "doc_count": 2
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 0.9
                                },
                                "key": 3,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 60
                                },
                                "key": 2,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 18,
                    "doc_count": 2
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 30
                                },
                                "key": 7,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 30
                                },
                                "key": 4,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 30
                                },
                                "key": 2,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 19,
                    "doc_count": 3
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 3,
                        "buckets": [
                            {
                                "1": {
                                    "value": 30
                                },
                                "key": 7,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 30
                                },
                                "key": 6,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 124.51
                                },
                                "key": 5,
                                "doc_count": 5
                            },
                            {
                                "1": {
                                    "value": 30
                                },
                                "key": 4,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 150
                                },
                                "key": 2,
                                "doc_count": 2
                            }
                        ]
                    },
                    "key": 20,
                    "doc_count": 13
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 30
                                },
                                "key": 7,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 60
                                },
                                "key": 6,
                                "doc_count": 2
                            },
                            {
                                "1": {
                                    "value": 30
                                },
                                "key": 5,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 60
                                },
                                "key": 1,
                                "doc_count": 2
                            }
                        ]
                    },
                    "key": 21,
                    "doc_count": 6
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 35
                                },
                                "key": 7,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 32
                                },
                                "key": 6,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 30
                                },
                                "key": 5,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 32
                                },
                                "key": 3,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 30
                                },
                                "key": 1,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 22,
                    "doc_count": 5
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 35
                                },
                                "key": 6,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 130
                                },
                                "key": 5,
                                "doc_count": 3
                            },
                            {
                                "1": {
                                    "value": 35
                                },
                                "key": 2,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 23,
                    "doc_count": 5
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 25
                                },
                                "key": 7,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 5.5
                                },
                                "key": 6,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 20
                                },
                                "key": 3,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 180
                                },
                                "key": 1,
                                "doc_count": 4
                            }
                        ]
                    },
                    "key": 24,
                    "doc_count": 7
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 150
                                },
                                "key": 6,
                                "doc_count": 3
                            },
                            {
                                "1": {
                                    "value": 30
                                },
                                "key": 5,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 30
                                },
                                "key": 3,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 25,
                    "doc_count": 5
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 260
                                },
                                "key": 7,
                                "doc_count": 3
                            },
                            {
                                "1": {
                                    "value": 60
                                },
                                "key": 5,
                                "doc_count": 2
                            },
                            {
                                "1": {
                                    "value": 50
                                },
                                "key": 3,
                                "doc_count": 2
                            }
                        ]
                    },
                    "key": 26,
                    "doc_count": 7
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 31
                                },
                                "key": 6,
                                "doc_count": 2
                            },
                            {
                                "1": {
                                    "value": 240
                                },
                                "key": 3,
                                "doc_count": 3
                            },
                            {
                                "1": {
                                    "value": 50
                                },
                                "key": 2,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 80
                                },
                                "key": 1,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 27,
                    "doc_count": 7
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 1
                                },
                                "key": 4,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 300
                                },
                                "key": 3,
                                "doc_count": 5
                            }
                        ]
                    },
                    "key": 28,
                    "doc_count": 6
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 35
                                },
                                "key": 4,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 32
                                },
                                "key": 1,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 29,
                    "doc_count": 2
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 90
                                },
                                "key": 5,
                                "doc_count": 2
                            }
                        ]
                    },
                    "key": 31,
                    "doc_count": 2
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 35
                                },
                                "key": 7,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 30
                                },
                                "key": 5,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 37,
                    "doc_count": 2
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 240
                                },
                                "key": 3,
                                "doc_count": 3
                            }
                        ]
                    },
                    "key": 38,
                    "doc_count": 3
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 60
                                },
                                "key": 6,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 40,
                    "doc_count": 1
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 55
                                },
                                "key": 2,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 41,
                    "doc_count": 1
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 60
                                },
                                "key": 4,
                                "doc_count": 2
                            }
                        ]
                    },
                    "key": 44,
                    "doc_count": 2
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 20
                                },
                                "key": 3,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 46,
                    "doc_count": 1
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 25
                                },
                                "key": 7,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 10
                                },
                                "key": 1,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 47,
                    "doc_count": 2
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 25
                                },
                                "key": 4,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 48,
                    "doc_count": 1
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 40
                                },
                                "key": 1,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 51,
                    "doc_count": 1
                },
                {
                    "3": {
                        "doc_count_error_upper_bound": 0,
                        "sum_other_doc_count": 0,
                        "buckets": [
                            {
                                "1": {
                                    "value": 100
                                },
                                "key": 7,
                                "doc_count": 1
                            },
                            {
                                "1": {
                                    "value": 100
                                },
                                "key": 6,
                                "doc_count": 1
                            }
                        ]
                    },
                    "key": 52,
                    "doc_count": 2
                }
            ]
        }
    }
} // }}}

const getDateMonthsAgo = m => { let d = new Date(); d.setMonth(d.getMonth() - m); return d };

const startTimestamp = new Date(new Date().getFullYear()-1, 1, 1)/1000
const mkTime = (weekOfYear, dayOfWeek) => ((weekOfYear - 1) * 7 + dayOfWeek) * 3600*24 + startTimestamp
const datap = Object.fromEntries(data.aggregations["2"]["buckets"].flatMap(v =>
                v["3"]["buckets"].map(u => [mkTime(v["key"], u["key"]), u["1"]["value"]])))

const calConfig = {
    domain: "month",
    subDomain: "day",
    weekStartOnMonday: false,
    cellSize: 12,
    cellRadius: 4,
    domainMargin: [1, 1, 1, 1],
    domainGutter: 10,
    domainLabelFormat: "%b '%y",
    legendCellSize: 5,
    legendCellPadding: 3,
    legendHorizontalPosition: "right",
    highlight: "now",
    tooltip: true,
    data: datap,
    /* Properties to overwrite */
    start: new Date(),
    range: 12
}

new CalHeatMap().init({
    ...calConfig,
    range: 12,
    start: getDateMonthsAgo(11)
});

new CalHeatMap().init({
    ...calConfig,
    itemSelector: "#cal-heatmap-medium",
    range: 8,
    start: getDateMonthsAgo(7)
});

new CalHeatMap().init({
    ...calConfig,
    itemSelector: "#cal-heatmap-small",
    range: 6,
    start: getDateMonthsAgo(5)
});

// TODO: Range depends on window size (small = 6, big = 12) instead of hiding and showing divs

